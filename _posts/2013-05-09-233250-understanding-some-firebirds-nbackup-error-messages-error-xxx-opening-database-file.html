---
title: "Understanding (some) Firebird's nbackup error messages (\"Error (xxx) opening database file\")"
date: 2013-05-09T09:25:16Z
tags:
  - Firebird
  - Storage &amp; Backup
category: devel
layout: post
---
<p>Because on the server where the application is running I'm unable to do backup using regular <code>gbak</code> tool, I turned my attention to <code>nbackup</code>. In fact I'm doing just file copy and using <code>alter database begin backup</code>/<code>alter database end backup</code> (<a href="http://www.firebirdsql.org/manual/nbackup-lock-unlock.html">more info</a>). But doing the backup is only part of the story. You have also know you know how to restore it and whether you can restore it (aka whether the backup is not corrupted).</p>

<p>If you have done backup using process described above and you have the file, you can't just start using it. You need to "restore it", which means changing a flag inside the database file. This is where the <code>nbackup</code>'s <code>-F</code> switch comes to play. But no matter what I was doing, I was getting:</p> 

<pre class="brush:plain">
Failure: Error (5) opening database file: &lt;some&gt;.fdb
</pre>

<p>This error message is, well, completely utterly useless. While waiting for reply from <a href="http://www.firebirdsql.org/en/mailing-lists/">firebird-support list</a> I played with <a href="http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx">Process Monitor</a> (of course) to see what's wrong. But I haven't seen any disk activity with errors. Changing paths, trying invalid paths (this produced just error 3), running 32bit version of <code>nbackup</code>, using one from Firebird 2.1, ... And nothing. Then I decided to have a look into the ultimate documentation aka sources. It was not difficult to find piece of code:</p>

<pre class="brush:cpp">
b_error::raise(uSvc, "Error (%d) opening database file: %s", GetLastError(), dbname.c_str());
</pre>

<p>Great <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms679360(v=vs.85).aspx"><code>GetLastError</code></a>. Time to jump into <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms681381(v=vs.85).aspx">System Error Codes</a>. And in no time I know it's <code>ERROR_ACCESS_DENIED</code>. That's a progress. Quick check of permissions and yes; the user I was running under had no permission to write to the file. Quickly changing that and everything was working fine.</p>

<p>Hope it helps somebody.</p>
