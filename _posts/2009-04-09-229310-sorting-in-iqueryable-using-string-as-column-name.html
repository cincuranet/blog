---
title: "Sorting in IQueryable using string as column name"
date: 2009-04-09T20:33:00Z
tags:
  - Entity Framework
  - LINQ
category: none
layout: post
---
<p>Today my UI/ASP.NET guru workmate asked me whether it's possible to provide sorting methods on queries (in our case Entity Framework) using column name as string instead of expression. Well, I thought, why it shouldn't.</p>

<p>My first attention got to the <a href="http://msdn.microsoft.com/en-us/library/system.data.metadata.edm.metadataworkspace.aspx" >MetadataWorkspace</a>. After couple of attempts it became clear that this is not the best way. So I switched my attention to the expression trees. And that was the way. I ended up with this result.</p>
<pre class="brush:csharp">
private static IOrderedQueryable&lt;T&gt; OrderingHelper&lt;T&gt;(IQueryable&lt;T&gt; source, string propertyName, bool descending, bool anotherLevel)
{
    ParameterExpression param = Expression.Parameter(typeof(T), string.Empty); // I don't care about some naming
    MemberExpression property = Expression.PropertyOrField(param, propertyName);
    LambdaExpression sort = Expression.Lambda(property, param);

    MethodCallExpression call = Expression.Call(
        typeof(Queryable),
        (!anotherLevel ? "OrderBy" : "ThenBy") + (descending ? "Descending" : string.Empty),
        new[] { typeof(T), property.Type },
        source.Expression,
        Expression.Quote(sort));

    return (IOrderedQueryable&lt;T&gt;)source.Provider.CreateQuery&lt;T&gt;(call);
}

public static IOrderedQueryable&lt;T&gt; OrderBy&lt;T&gt;(this IQueryable&lt;T&gt; source, string propertyName)
{
    return OrderingHelper(source, propertyName, false, false);
}

public static IOrderedQueryable&lt;T&gt; OrderByDescending&lt;T&gt;(this IQueryable&lt;T&gt; source, string propertyName)
{
    return OrderingHelper(source, propertyName, true, false);
}

public static IOrderedQueryable&lt;T&gt; ThenBy&lt;T&gt;(this IOrderedQueryable&lt;T&gt; source, string propertyName)
{
    return OrderingHelper(source, propertyName, false, true);
}

public static IOrderedQueryable&lt;T&gt; ThenByDescending&lt;T&gt;(this IOrderedQueryable&lt;T&gt; source, string propertyName)
{
    return OrderingHelper(source, propertyName, true, true);
}
</pre>
<p>It's a set of extension methods with similar signature as the classic ones OrderBy, ThenBy, etc. only taking string parameter instead of expression. This string parameter is name of field in class to be used for sorting. Enjoy.</p>