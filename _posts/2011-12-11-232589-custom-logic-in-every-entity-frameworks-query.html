---
title: "Custom logic in every Entity Framework's query"
date: 2011-12-11T13:41:50Z
tags:
  - Entity Framework
  - Entity SQL
category: none
layout: post
---
<p>Few days ago there was a question on Twitter in <a href="{{ site.url }}{% post_url 2011-11-11-232567-improved-efhelp-hashtag-cooperation-with-efhelp %}"><code>#efhelp</code></a> about adding custom logic to every query in Entity Framework. It's pretty easy and you can do it absolutely transparently so nobody using your code needs to know.</p>

<p>First you need to focus you <a href="http://msdn.microsoft.com/en-us/library/ee382830.aspx">Entity Set</a> (not <a href="http://msdn.microsoft.com/en-us/library/ee382837.aspx">Entity Type</a>) in <a href="http://msdn.microsoft.com/en-us/library/bb738483.aspx">Model Browser</a> window.</p>

<p><img src="http://i.blog.cincura.net/CustomLogicEntitySet1.png" /></p>

<p>Here set the access modifier to i.e. <code>private</code> or (<code>internal</code>/<code>protected</code>) and rename it to something else, so it'll not interfere with original name of property we're going to create. I often use <code>X</code> prefix (especially for properties on entities).</p> 

<p><img src="http://i.blog.cincura.net/CustomLogicEntitySet2.png" /></p>

<p>Now it's pretty easy to create some logic. Here I simply added filtering to always only fetch entities younger than 10 days from now.</p>

<pre class="brush:csharp">
partial class Model1Container
{
	public IQueryable&lt;FooBarEntity&gt; FooBarEntitySet
	{
		get
		{
			DateTime d = DateTime.UtcNow.AddDays(-10);
			return XFooBarEntitySet.Where(fb =&gt; fb.Created &gt; d);
		}
	}
}
</pre>

<p>And that's it. Not a difficult task. But also note that through <a href="http://msdn.microsoft.com/en-us/library/bb399560.aspx">Entity SQL</a> (or i.e. reflection) somebody might be still able to access original entity set and get access to the data. So it's not rock hard security solution.</p>
