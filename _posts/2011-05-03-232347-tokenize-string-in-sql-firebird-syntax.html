---
title: "Tokenize string in SQL (Firebird syntax)"
date: 2011-05-03T19:00:18Z
tags:
  - Firebird
  - SQL
category: none
layout: post
---
<p>Few days ago I wrote <a href="{{ site.url }}{% post_url 2011-04-25-232323-some-thoughts-on-denormalization %}">"Some thoughts on denormalization" post</a>. Though concatenating data to one string is easy with there introduced function, splitting it back could be harder. I left it as exercise, but I feel, to make it complete, it's good to show one possible implementation.</p>

<p>Here's one I came with today (using <a href="http://www.firebirdsql.org">Firebird</a> syntax, however it's almost pure <a href="http://en.wikipedia.org/wiki/SQL">SQL</a>), quickly. It's something I created from start to finish in one row and sure for some cases it could be optimized.</p>

<pre class="brush:sql">
recreate procedure Tokenize(input varchar(1024), token char(1))
returns (result varchar(255))
as
declare newpos int;
declare oldpos int;
begin
  oldpos = 1;
  newpos = 1;
  while (1 = 1) do
  begin
    newpos = position(token, input, oldpos);
    if (newpos > 0) then
    begin
      result = substring(input from oldpos for newpos - oldpos);
      suspend;
      oldpos = newpos + 1;
    end
    else if (oldpos - 1 &lt; char_length(input)) then
    begin
      result = substring(input from oldpos);
      suspend;
      break;
    end
    else
    begin
      break;
    end
  end
end
</pre>

<p>The procedure splits the <code>input</code> string using the specified <code>token</code>. The string can (or not) end with the token itself, the procedure will handle it.</p>

<pre class="brush:sql">
select * from Tokenize('ab,cd,e', ',')
union all
select * from Tokenize('ab,cd,e,', ',');
union all
select * from Tokenize('ab,cd,e,,', ',');
</pre>

<p>What it is not handling is some form of quoting in case there's a token inside the element. Mainly because its intended purpose is to tokenize strings you can control (<a href="{{ site.url }}{% post_url 2011-04-25-232323-some-thoughts-on-denormalization %}">see the previous post</a>) and because it will slow down the execution.</p>

<p>Feel free to improve it etc. (either post link to your solution or post the code in comments).</p>