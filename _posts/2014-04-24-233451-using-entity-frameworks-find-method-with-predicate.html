---
title: "Using Entity Framework's Find method with predicate"
date: 2014-04-24T05:21:00Z
tags:
  - Entity Framework
  - LINQ
category: none
layout: post
---
<p>Today I spotted <a href="{{ site.url }}{% post_url 2013-10-13-233423-efhelp-hashtag-now-better-than-ever %}"><code>#efhelp</code></a> <a href="https://twitter.com/pilotbob/status/459035141672009728">question on Twitter</a> about using <a href="http://msdn.microsoft.com/en-us/library/gg696418.aspx"><code>Find</code></a> method but with predicate.</p> 
<!-- excerpt -->
<p>The <code>Find</code> method is smart. It first checks whether the record with given key(s) is present in current <a href="http://msdn.microsoft.com/en-us/library/system.data.entity.dbcontext.aspx"><code>DbContext</code></a> locally and if so it returns it. Else it sends the query into database and returns what database has. Sadly the method only accepts key(s), not a i.e. predicate.</p>

<p>But thanks to <a href="http://msdn.microsoft.com/en-us/library/gg696248.aspx"><code>Local</code> property on <code>DbSet</code></a> it's not that difficult to create similar behavior.</p>

<pre class="brush:csharp">
public static IEnumerable&lt;T&gt; FindPredicate&lt;T&gt;(this DbSet&lt;T&gt; dbSet, Expression&lt;Func&lt;T, bool&gt;&gt; predicate) where T : class
{
	var local = dbSet.Local.Where(predicate.Compile());
	return local.Any()
		? local
		: dbSet.Where(predicate).ToArray();
}

public static async Task&lt;IEnumerable&lt;T&gt;&gt; FindPredicateAsync&lt;T&gt;(this DbSet&lt;T&gt; dbSet, Expression&lt;Func&lt;T, bool&gt;&gt; predicate) where T : class
{
	var local = dbSet.Local.Where(predicate.Compile());
	return local.Any()
		? local
		: await dbSet.Where(predicate).ToArrayAsync().ConfigureAwait(false);
}
</pre>

<p>The method first checks "local" source, if there's nothing - either the record(s) are really not in memory yet or the predicate doesn't match anything (2<sup>nd</sup> item is important to keep in mind) - it hits the database. For convenience I also included asynchronous version of the same method.</p>