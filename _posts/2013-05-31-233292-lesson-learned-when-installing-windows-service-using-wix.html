---
title: "Lesson learned when installing Windows service using WiX"
date: 2013-05-31T12:25:32Z
tags:
  - Lessons learned
  - PowerShell
  - Windows
  - WiX
category: devel
layout: post
---
As I was creating, few months back, some Windows service I also created <code>MSI</code> installer, using <a href="http://wixtoolset.org/">WiX</a>, for it. Pretty straightforward â€“ bunch of files in one <code>Component</code> plus <code>ServiceInstall</code> and <code>ServiceControl</code>. Then as the service started to gain some features I had referenced some assemblies. So I had to always update the installer script to include new files. This turned out to be main problem, because I forgot it quite a few times. So I decided to script it. 

Scripting is good. At least if done properly. :) In my case I made a small mistake. I created a simple <a href="http://www.microsoft.com/powershell">PowerShell</a> script that loaded the <code>WXS</code> file, listed all <code>*.dll</code>/<code>*.exe</code> files in <code>bin</code> directory (plus some other files) and created items in <code>Component</code>. Nothing special. Right? It only had a one small gotcha. I'm pretty sure it's described in documentation very likely, but ... you know. The problem was that the script was creating the items in <code>Component</code> in no particular order. To be precise it was listing the files and adding lines like stack. And last files processed was the other files. The installer was created fine, no error. Even the installation went well. Until it reached the point where the service should be started. It was failing. Consistently. Of course I was really installing (I mean finishing the installation) few weeks after I did this refactoring. Before, just seeing it started was fine for me. And I had no clue what's going on. I compared the old <code>WXS</code> file with new one. Except for formatting and some ordering it was same. <a href="http://en.wikipedia.org/wiki/Event_Viewer">Event Log</a> was saying nothing. Full verbose logging install was not giving any clue. After like two hours wasted I was getting out of bullets. But then I realized something. The <code>ServiceInstall</code> nor <code>ServiceControl</code> element has a "reference" to the service executable. How's the installer going to know what service to install and run? Yes, the service executable needs to be first in list of files. When I realized it I knew I read it somewhere. Quickly fixing the PowerShell script and I was fine.

Although I thought my "refactoring" was fine, because the all the files were there and the installer even installed these, I messed the order. Order matters. Lesson learned.

