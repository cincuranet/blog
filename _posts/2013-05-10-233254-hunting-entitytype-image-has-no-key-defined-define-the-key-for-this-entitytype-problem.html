---
title: "Hunting \"EntityType 'Image' has no key defined. Define the key for this EntityType.\" problem"
date: 2013-05-10T07:53:24Z
tags:
  - Entity Framework
  - Firebird
category: none
layout: post
---
<p>Few weeks back I was <a href="http://www.x2develop.com">hired</a> to debug the above mentioned problem. The application was using <a href="http://msdn.com/ef">Entity Framework 5</a> and <a href="http://www.firebirdsql.org">Firebird</a> as a database. The message says clearly what's wrong. How hard can it be to fix the problem, right? I was thinking the same. And how wrong I was.</p>
<!-- excerpt -->
<p>After receiving the sources and quickly extracting the bare metal with error I started looking for <code>Image</code> type. And there it was. The class had <code>Id</code> property, so the key was kind of there. The default convention should be able to find. Let's look at configuration, if there's something suspicious. And even better, the <a href="http://msdn.microsoft.com/en-us/library/gg671266(v=vs.103).aspx"><code>HasKey</code></a> call is there. OK, maybe there's some magic in <a href="http://msdn.microsoft.com/en-us/library/system.data.entity.dbcontext.onmodelcreating(v=vs.103).aspx"><code>OnModelCreating</code></a>. Nope. Everything as expected.</p>

<p>By the way, the exact error was:</p>
<pre class="brush:plain">
ModelValidationException: One or more validation errors were detected during model generation:

	System.Data.Entity.Edm.EdmEntityType: : EntityType 'Image' has no key defined. Define the key for this EntityType.
	System.Data.Entity.Edm.EdmEntitySet: EntityType: EntitySet 'Images' is based on type 'Image' that has no keys defined.
</pre>

<p>That's the overview. Next two hours I was trying to changes something here and there and make it fail, so I knew it's doing what it should do. Removing some stuff that might break something. And still no luck. But then something caught my eye. The error is talking about "Image" type. My type from database is "IMAGE" (the mapping and classes were generated by <a href="http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d">Entity Framework Power Tools</a> and because of how SQL standard defines non-quoted names, it's by default all uppercase). Yes, there was a property added to some entity that had a type <a href="http://msdn.microsoft.com/en-us/library/system.drawing.image.aspx"><code>Image</code></a>, I mean <a href="http://msdn.microsoft.com/en-us/library/system.drawing.image.aspx"><code>System.Drawing.Image</code></a>.</p>

<p>So quickly adding <a href="http://msdn.microsoft.com/en-us/library/gg696314(v=vs.103).aspx"><code>Ignore</code></a> into <code>OnModelCreating</code> and I was done. Lesson learned.</p>

