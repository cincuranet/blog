---
title: "BuildNotContainsExpression"
date: 2009-04-19T10:28:00Z
tags:
  - Entity Framework
  - LINQ
redirect_from: /id/229526
category: none
layout: post
---
<p><a href="http://blogs.msdn.com/meek/">Colin Meek</a> wrote extremely handy method for using it as Contains method we know it's on collections, but not supported in Entity Framework right now (v1/EF3.5). The method is called BuildContainsExpression. Today in MSDN forums I needed this, but negated. Thus I wrote the BuildNotContainsExpression. It's just small change of original Colin's method.</p>

<pre class="brush:csharp">
static Expression&lt;Func&lt;TElement, bool&gt;&gt; BuildNotContainsExpression&lt;TElement, TValue&gt;(Expression&lt;Func&lt;TElement, TValue&gt;&gt; valueSelector, IEnumerable&lt;TValue&gt; values)
{
    if (null == valueSelector) { throw new ArgumentNullException("valueSelector"); }
    if (null == values) { throw new ArgumentNullException("values"); }

    ParameterExpression p = valueSelector.Parameters.Single();

    // p =&gt; valueSelector(p) != values[0] &amp;&amp; valueSelector(p) != ...

    if (!values.Any())
    {
        return e =&gt; true;
    }

    var equals = values.Select(value =&gt; (Expression)Expression.NotEqual(valueSelector.Body, Expression.Constant(value, typeof(TValue))));
    var body = equals.Aggregate&lt;Expression&gt;((accumulate, equal) =&gt; Expression.And(accumulate, equal));
    return Expression.Lambda&lt;Func&lt;TElement, bool&gt;&gt;(body, p);
}
</pre>