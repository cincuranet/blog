---
title: "CountdownEvent example"
date: 2009-06-10T08:49:00Z
tags:
  - .NET
  - Multithreading/Parallelism/Asynchronous/Concurrency
redirect_from: /id/230555
category: none
layout: post
---
<p>Yesterday <a href="{{ site.url }}{% post_url 2009-06-09-230550-countdownevent-class %}">I wrote</a> about new CountdownEvent class. But what's better than see some example of usage? ;-)</p>

<p>Below is pretty simple example of usage. You can see, it's very similar to work with array of i.e. <a href="http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx">ManualResetEvent</a>. But you have also some handy methods and properties. For instance: <a href="http://msdn.microsoft.com/en-us/library/system.threading.countdownevent.addcount(VS.100).aspx">AddCount</a>/<a href="http://msdn.microsoft.com/en-us/library/system.threading.countdownevent.tryaddcount(VS.100).aspx">TryAddCount</a> or <a href="http://msdn.microsoft.com/en-us/library/system.threading.countdownevent.currentcount(VS.100).aspx">CurrentCount</a>. Very handy.</p>
<pre class="brush:csharp">
class Program
{
		static void Main(string[] args)
		{
				using (CountdownEvent cde = new CountdownEvent(10))
				{
					for (int i = 0; i &lt; cde.InitialCount; i++)
					{
							new Thread(new ParameterizedThreadStart(Dummy)).Start(cde);
							//ThreadPool.QueueUserWorkItem(new WaitCallback(Dummy), cde);
					}
					cde.Wait(2000);
					Console.WriteLine("Threads done in first 2 seconds: {0}.", cde.InitialCount - cde.CurrentCount);
					cde.Wait();
					Console.WriteLine("All threads done.");
				}
		}

		static void Dummy(object o)
		{
				Thread.Sleep(new Random().Next(5000));
				(o as CountdownEvent).Signal();
		}
}
</pre>
<p>As I said, the work is similar to work with array of ManualResetEvent, just packed into nicer cake. In fact, if you start ILDasm and look into the code you'll see, that's implemented very similarly. It's using <a href="http://msdn.microsoft.com/en-us/library/system.threading.manualreseteventslim(VS.100).aspx">ManualResetEventSlim</a> (also new in .NET 4) internally to signal and smart work with <a href="http://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx">Interlocked class</a> do decrement (or increment) the number of signals received.</p>

<p>Do you like the class too?</p>